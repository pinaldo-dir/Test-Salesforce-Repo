<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Chatters @SF_Admins on Judgment record that the Case update failed.</description>
        <name>Chatter_Case_Update_Fault</name>
        <label>Chatter: Case Update Fault</label>
        <locationX>314</locationX>
        <locationY>638</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>@[SF_Admins] Case Stage and Status update failed.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Chatter_Flow_Started</name>
        <label>Chatter: Flow Started</label>
        <locationX>314</locationX>
        <locationY>278</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <connector>
            <targetReference>New_Judgment</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>WCA Judgment Flow Started. Valid Inputs.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Judgment did not meet criteria for Post-Hearing Interest calculation. Verify the Interest Rate is set, the Mailing Date is set, the Record Type is correct, and the Status is &quot;Open&quot;.</description>
        <name>Chatter_Interest_Calculation_Unnecessary</name>
        <label>Chatter: Interest Calculation Unnecessary</label>
        <locationX>380</locationX>
        <locationY>1478</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>Judgment did not meet criteria for Post-Hearing Interest calculation. Verify the Interest Rate is set, the Mailing Date is set, the Record Type is correct, and the Status is &quot;Open&quot;.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Chatter @SF_Admins</description>
        <name>Chatter_Interest_Rate_Query_Fault</name>
        <label>Chatter: Interest Rate Query Fault</label>
        <locationX>1172</locationX>
        <locationY>1118</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>@[SF_Admins] Attempt to retrieve interest rate for this judgment failed in Judgment Flow. Please verify Custom Setting -&gt; Interest.Interest_Rate__c.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Chatter @SF_Admins</description>
        <name>Chatter_Interest_Rate_Update_Fault</name>
        <label>Chatter: Interest Rate Update Fault</label>
        <locationX>908</locationX>
        <locationY>1238</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>[@SF_Admins] Attempt to update Judgement__c.Interest_Rate__c in Judgment Flow failed.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>Chatters @SF_Admins that inputs were invalid for this flow to run.</description>
        <name>Chatter_Invalid_Inputs</name>
        <label>Chatter: Invalid Inputs</label>
        <locationX>1436</locationX>
        <locationY>278</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>@[SF_Admins] Inputs the the &quot;Judgment Flow&quot; were invalid. The flow exited.</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>57.0</apiVersion>
    <decisions>
        <description>Set to be always True in Process Builder.</description>
        <name>Mailing_Date_changed</name>
        <label>Mailing Date Changed?</label>
        <locationX>512</locationX>
        <locationY>1358</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>boolMailingDateChanged</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Chatter_Interest_Calculation_Unnecessary</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>( {!varCreatedDate} = {!varLastModifiedDate} &amp;&amp; {!varJudgmentStatus} &lt;&gt; &apos;Preliminary&apos; )</description>
        <name>New_Judgment</name>
        <label>New Judgment?</label>
        <locationX>314</locationX>
        <locationY>398</locationY>
        <defaultConnector>
            <targetReference>Query_Interest_Rate</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not New</defaultConnectorLabel>
        <rules>
            <name>New</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>fIsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Case_Stage_And_Status</targetReference>
            </connector>
            <label>New</label>
        </rules>
    </decisions>
    <decisions>
        <description>Mailing Date != null &amp;&amp; Mailing Date changed &amp;&amp; Judgment Status contains &apos;Open&apos;</description>
        <name>Post_Hearing_Interest_Calc_Needed</name>
        <label>Post-Hearing Interest Calc Needed?</label>
        <locationX>314</locationX>
        <locationY>1238</locationY>
        <defaultConnector>
            <targetReference>Mailing_Date_changed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>1 AND 2 AND 3</conditionLogic>
            <conditions>
                <leftValueReference>varMailingDate</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>boolMailingDateChanged</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varJudgmentStatus</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <stringValue>Open</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Calculate_Interest_on_Judgment</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>WCA record type &amp;&amp;
Judgment Id != null &amp;&amp; 
Judgment Status != null</description>
        <name>WCA_RT_Valid_Inputs</name>
        <label>WCA RT &amp; Valid Inputs?</label>
        <locationX>875</locationX>
        <locationY>158</locationY>
        <defaultConnector>
            <targetReference>Chatter_Invalid_Inputs</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varJudgmentID</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varRecType</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>WCA</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varJudgmentStatus</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Chatter_Flow_Started</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <description>Formula to determine if the judgment is new or not.</description>
        <name>fIsNew</name>
        <dataType>Boolean</dataType>
        <expression>IF ( {!varCreatedDate} = {!varLastModifiedDate} &amp;&amp; {!varJudgmentStatus} &lt;&gt; &apos;Preliminary&apos; , True, False)</expression>
    </formulas>
    <interviewLabel>Judgment Flow {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Judgment Flow</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <description>Queries the &quot;Interest&quot; Custom Setting. As of Mar 2023, always only returns 10% anyway.</description>
        <name>Query_Interest_Rate</name>
        <label>Query Interest Rate</label>
        <locationX>314</locationX>
        <locationY>998</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Update_Interest_Rate_Field_On_Judgment</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Chatter_Interest_Rate_Query_Fault</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Object__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Judgment__c</stringValue>
            </value>
        </filters>
        <filters>
            <field>Record_Type__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>WCA</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Open</stringValue>
            </value>
        </filters>
        <object>Interest__c</object>
        <outputAssignments>
            <assignToReference>varJudgmentInterestRate</assignToReference>
            <field>Interest_Rate__c</field>
        </outputAssignments>
    </recordLookups>
    <recordUpdates>
        <name>Update_Case_Stage_And_Status</name>
        <label>Update Case Stage And Status</label>
        <locationX>50</locationX>
        <locationY>518</locationY>
        <connector>
            <targetReference>Query_Interest_Rate</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Chatter_Case_Update_Fault</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varCaseID</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Case_Stage__c</field>
            <value>
                <stringValue>Judgment</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Judgment Issued</stringValue>
            </value>
        </inputAssignments>
        <object>DIR_Case__c</object>
    </recordUpdates>
    <recordUpdates>
        <description>Populates the Interest_Rate__c field on the Judgement__c record for calculation of interest due.</description>
        <name>Update_Interest_Rate_Field_On_Judgment</name>
        <label>Update Interest Rate Field On Judgment</label>
        <locationX>314</locationX>
        <locationY>1118</locationY>
        <connector>
            <targetReference>Post_Hearing_Interest_Calc_Needed</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Chatter_Interest_Rate_Update_Fault</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Interest_Rate__c</field>
            <value>
                <elementReference>varJudgmentInterestRate</elementReference>
            </value>
        </inputAssignments>
        <object>Judgement__c</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <start>
        <locationX>749</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>WCA_RT_Valid_Inputs</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <subflows>
        <name>Calculate_Interest_on_Judgment</name>
        <label>Calculate Interest on Judgment</label>
        <locationX>116</locationX>
        <locationY>1358</locationY>
        <flowName>Calculate_Violation_Interest</flowName>
        <inputAssignments>
            <name>varHearingEffectiveDate</name>
            <value>
                <elementReference>varHearingEffectiveDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varInterestRate</name>
            <value>
                <elementReference>varJudgmentInterestRate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varJudgmentAmt</name>
            <value>
                <elementReference>varJudgmentAmt</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varJudgmentID</name>
            <value>
                <elementReference>varJudgmentID</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varJudgmentMailingDate</name>
            <value>
                <elementReference>varMailingDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varJudgmentType</name>
            <value>
                <elementReference>varJudgmentType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varODABySettlementDate</name>
            <value>
                <elementReference>varODABySettlementDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varRecType</name>
            <value>
                <elementReference>varRecType</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varStatus</name>
            <value>
                <elementReference>varJudgmentStatus</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <description>Passed from PB indicating that the mailing date has changed and, therefore, interest calc is required.</description>
        <name>boolMailingDateChanged</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Case ID of the parent case of the judgment</description>
        <name>varCaseID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Created Date of the judgment passed from the flow. Used to determine if the record is new or not</description>
        <name>varCreatedDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Effective date of hearing passed from PB</description>
        <name>varHearingEffectiveDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Amount of the judgment that started the flow</description>
        <name>varJudgmentAmt</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>ID of the judgment that triggered the flow</description>
        <name>varJudgmentID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Interest Rate field from Judgment</description>
        <name>varJudgmentInterestRate</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>5</scale>
    </variables>
    <variables>
        <description>Status of the judgment that started the flow</description>
        <name>varJudgmentStatus</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>judgment type passed by PB</description>
        <name>varJudgmentType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Last modified date of the judgment that triggered the flow. Used to determine if the judgment is new or not</description>
        <name>varLastModifiedDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Mailing date set on the judgment</description>
        <name>varMailingDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>ODA by settlment date from the settlement passed by PB</description>
        <name>varODABySettlementDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Holds value of post hearing interest passed from PB for judgments that have interest already calculated</description>
        <name>varPostHearingInterest</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>Record type of the judgment that triggered the flow</description>
        <name>varRecType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
</Flow>
