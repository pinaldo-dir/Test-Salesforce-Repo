<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Claimant_not_located</name>
        <label>Claimant not located</label>
        <locationX>1154</locationX>
        <locationY>438</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varSettlementId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>text</name>
            <value>
                <stringValue>Claimant could not be located</stringValue>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Debug</name>
        <label>Debug</label>
        <locationX>520</locationX>
        <locationY>822</locationY>
        <actionName>chatterPost</actionName>
        <actionType>chatterPost</actionType>
        <inputParameters>
            <name>subjectNameOrId</name>
            <value>
                <elementReference>varSettlementId</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>text</name>
            <value>
                <elementReference>DebugText</elementReference>
            </value>
        </inputParameters>
        <nameSegment>chatterPost</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    <assignments>
        <description>Sets flag stating that interest update is required on the settlement</description>
        <name>Flag_Interest_Update</name>
        <label>Flag Interest Update</label>
        <locationX>158</locationX>
        <locationY>434</locationY>
        <assignmentItems>
            <assignToReference>varInterestUpdate</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Get_Interest_Rate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Input_Variable_Check</name>
        <label>Input Variable Check</label>
        <locationX>158</locationX>
        <locationY>51</locationY>
        <assignmentItems>
            <assignToReference>varSettlementId</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCaseId</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varInterestAccruableAmount</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varDateAmountDue</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varDueDate</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varCreatedDate</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varLastModifiedDate</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>Valid_Inputs</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Sets boolean flag to update the claimant</description>
        <name>Set_Claimant_Update</name>
        <label>Set Claimant Update</label>
        <locationX>892</locationX>
        <locationY>441</locationY>
        <assignmentItems>
            <assignToReference>varUpdateClaimant</assignToReference>
            <operator>Assign</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Check</targetReference>
        </connector>
    </assignments>
    <decisions>
        <description>Determines if the interest calculation is necessary</description>
        <name>Calculate_Interest</name>
        <label>Calculate Interest</label>
        <locationX>156</locationX>
        <locationY>307</locationY>
        <defaultConnector>
            <targetReference>Claimant_Update_Needed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Do Not Calculate</defaultConnectorLabel>
        <rules>
            <name>Calculate</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varDateAmountDue</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varInterestAccruableAmount</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Flag_Interest_Update</targetReference>
            </connector>
            <label>Calculate</label>
        </rules>
    </decisions>
    <decisions>
        <description>Checks whether or not the claimant needs to be updated</description>
        <name>Claimant_Update_Needed</name>
        <label>Claimant Update Needed</label>
        <locationX>665</locationX>
        <locationY>214</locationY>
        <defaultConnector>
            <targetReference>Update_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>[Default Outcome]</defaultConnectorLabel>
        <rules>
            <name>Update_Claimant</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>varCaseRoleId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varCaseRoleId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue></stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Has_CaseID</targetReference>
            </connector>
            <label>Update Claimant</label>
        </rules>
    </decisions>
    <decisions>
        <name>Has_CaseID</name>
        <label>Has CaseID</label>
        <locationX>886</locationX>
        <locationY>306</locationY>
        <defaultConnector>
            <targetReference>Update_Check</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>CaseID Null</defaultConnectorLabel>
        <rules>
            <name>CaseId_Is_Not_NULL</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varCaseId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Lookup_Case_Roles_Claimant</targetReference>
            </connector>
            <label>CaseId Is Not NULL</label>
        </rules>
    </decisions>
    <decisions>
        <description>Determines which updates are necessary on settlement</description>
        <name>Update_Check</name>
        <label>Update Check</label>
        <locationX>662</locationX>
        <locationY>443</locationY>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>Update_Both</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varInterestUpdate</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varUpdateClaimant</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Settlement_Claimant_Field_0</targetReference>
            </connector>
            <label>Update Both</label>
        </rules>
        <rules>
            <name>Update_Interest_on_Settlement</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varInterestUpdate</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Settlement_Interest_Field</targetReference>
            </connector>
            <label>Update Interest</label>
        </rules>
        <rules>
            <name>Update_Claimant1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varUpdateClaimant</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Settlement_Claimant_Field</targetReference>
            </connector>
            <label>Update Claimant</label>
        </rules>
    </decisions>
    <decisions>
        <name>Valid_Inputs</name>
        <label>Valid Inputs</label>
        <locationX>158</locationX>
        <locationY>172</locationY>
        <defaultConnectorLabel>Invalid</defaultConnectorLabel>
        <rules>
            <name>Valid</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>varSettlementId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>varCaseId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Calculate_Interest</targetReference>
            </connector>
            <label>Valid</label>
        </rules>
    </decisions>
    <description>Handles all actions when a settlement is created or updated
- Added updates for the interest amount and default amount via flow to be removed from workflow rules.</description>
    <formulas>
        <description>Calculates the default amount after geting the interest rate and interest amount</description>
        <name>flaDefaultAmount</name>
        <dataType>Currency</dataType>
        <expression>{!varInterestAccruableAmount} + {!varNonInterestAmount} + {!flaInterestAmount}</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>Calculates the interest amount using the interest rate looked up in the calculate interst subflow</description>
        <name>flaInterestAmount</name>
        <dataType>Currency</dataType>
        <expression>{!varInterestAccruableAmount} * ( ( {!varDueDate} - {!varDateAmountDue} ) / 365 ) * ( 0.01 * {!varInterestRate} )</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <description>Calculates the interest amount from the inputs to the flow and the looked up interest rate</description>
        <name>flaInterestCalculate</name>
        <dataType>Currency</dataType>
        <expression>{!varInterestAccruableAmount} * ( {!varDueDate} - {!varDateAmountDue} ) / 365 * ( {!varInterestRate} * 0.01 )</expression>
        <scale>2</scale>
    </formulas>
    <interviewLabel>Settlement Flow {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Settlement Flow</label>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Lookup_Case_Roles_Claimant</name>
        <label>Lookup Case Roles - Claimant</label>
        <locationX>1154</locationX>
        <locationY>297</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_Claimant_Update</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Claimant_not_located</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Case__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varCaseId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Role__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Claimant</stringValue>
            </value>
        </filters>
        <object>Case_Role__c</object>
        <outputAssignments>
            <assignToReference>varClaimantName</assignToReference>
            <field>Account_Name__c</field>
        </outputAssignments>
        <outputAssignments>
            <assignToReference>varCaseRoleId</assignToReference>
            <field>Id</field>
        </outputAssignments>
    </recordLookups>
    <recordUpdates>
        <name>Update_Settlement_Claimant_Field</name>
        <label>Update Settlement - Claimant Field</label>
        <locationX>520</locationX>
        <locationY>709</locationY>
        <connector>
            <targetReference>Debug</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varSettlementId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Claimant__c</field>
            <value>
                <elementReference>varClaimantName</elementReference>
            </value>
        </inputAssignments>
        <object>Settlement__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Settlement_Claimant_Field_0</name>
        <label>Update Settlement - Claimant Field</label>
        <locationX>827</locationX>
        <locationY>708</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varSettlementId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Claimant__c</field>
            <value>
                <elementReference>varClaimantName</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Default_Amount__c</field>
            <value>
                <elementReference>flaDefaultAmount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Interest_Amount__c</field>
            <value>
                <elementReference>flaInterestAmount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Interest_Rate__c</field>
            <value>
                <elementReference>varInterestRate</elementReference>
            </value>
        </inputAssignments>
        <object>Settlement__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Settlement_Interest_Field</name>
        <label>Update Settlement - Interest Field</label>
        <locationX>667</locationX>
        <locationY>761</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>varSettlementId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Default_Amount__c</field>
            <value>
                <elementReference>flaDefaultAmount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Interest_Amount__c</field>
            <value>
                <elementReference>flaInterestAmount</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Interest_Rate__c</field>
            <value>
                <elementReference>varInterestRate</elementReference>
            </value>
        </inputAssignments>
        <object>Settlement__c</object>
    </recordUpdates>
    <startElementReference>Valid_Inputs</startElementReference>
    <status>Active</status>
    <subflows>
        <name>Get_Interest_Rate</name>
        <label>Get Interest Rate</label>
        <locationX>324</locationX>
        <locationY>435</locationY>
        <connector>
            <targetReference>Claimant_Update_Needed</targetReference>
        </connector>
        <flowName>Calculate_Violation_Interest</flowName>
        <inputAssignments>
            <name>varRecordID</name>
            <value>
                <elementReference>varSettlementId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <name>varRecordObject</name>
            <value>
                <stringValue>Settlement</stringValue>
            </value>
        </inputAssignments>
        <outputAssignments>
            <assignToReference>varInterestRate</assignToReference>
            <name>varInterestRate</name>
        </outputAssignments>
    </subflows>
    <textTemplates>
        <name>DebugText</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>SettlementId - {!varSettlementId}
CaseId - {!varCaseId}
CaseRoleId - {!varCaseRoleId}
Claimant - {!varClaimantName}</text>
    </textTemplates>
    <variables>
        <name>varCaseId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Claimant case role</description>
        <name>varCaseRoleId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>varClaimantName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Created Date of the settlement</description>
        <name>varCreatedDate</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Date the amount was due the employee, not the settlement due date</description>
        <name>varDateAmountDue</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Date the settlement was due</description>
        <name>varDueDate</name>
        <dataType>Date</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>Amount due that accrues interest passed from PB</description>
        <name>varInterestAccruableAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>Interest rate looked up in subflow</description>
        <name>varInterestRate</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <description>boolean flag indicating that updating the interest is necessary for the settlement</description>
        <name>varInterestUpdate</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Date the settlement was last modified</description>
        <name>varLastModifiedDate</name>
        <dataType>DateTime</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Amount on settlement that does not accrue interest. Passed from process</description>
        <name>varNonInterestAmount</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>varSettlementId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>varUpdateClaimant</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
</Flow>
